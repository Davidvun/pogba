{% extends 'base.html' %}
{% block title %}Take Quiz{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">{{ quiz.title }}</h1>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
        <p class="text-yellow-800"><strong>Time Limit:</strong> {{ quiz.time_limit }} minutes | <strong>Pass:</strong> {{ quiz.pass_percentage }}%</p>
    </div>
    <form id="quiz-form" class="space-y-6">
        {% csrf_token %}
        {% for q in questions %}
        <div class="bg-white rounded-lg shadow-md p-6">
            <p class="font-bold text-lg mb-4">Q{{ forloop.counter }}: {{ q.question_text }}</p>
            <div class="space-y-2">
                {% for answer in q.answers.all %}
                <label class="flex items-center p-3 bg-gray-50 rounded hover:bg-gray-100 cursor-pointer">
                    <input type="radio" name="q{{ q.id }}" value="{{ answer.id }}" class="mr-3">
                    <span>{{ answer.answer_text }}</span>
                </label>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        <button type="submit" class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Submit Quiz</button>
    </form>
</div>
<script>
document.getElementById('quiz-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const answers = [];
    {% for q in questions %}
    const q{{ q.id }} = formData.get('q{{ q.id }}');
    if (q{{ q.id }}) answers.push({question_id: {{ q.id }}, answer_id: parseInt(q{{ q.id }})});
    {% endfor %}
    const response = await fetch('{% url "submit_quiz" quiz.id %}', {
        method: 'POST',
        headers: {'Content-Type': 'application/json', 'X-CSRFToken': formData.get('csrfmiddlewaretoken')},
        body: JSON.stringify({answers})
    });
    const data = await response.json();
    alert(`Quiz Complete!\nScore: ${data.score}/${data.total_points}\nPercentage: ${data.percentage.toFixed(1)}%\nStatus: ${data.is_passed ? 'PASSED' : 'FAILED'}`);
    window.location.href = '/quizzes/attempts/' + data.attempt_id + '/results/';
});
</script>
{% endblock %}
